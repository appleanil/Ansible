Ansible
=======

ïƒ¨   Linux 
ïƒ¨   Shell scripting
ïƒ¨   SCM tools: git [github, bitbucket, gitlab]
ïƒ¨   Build tools: maven, gradle, Ant
ïƒ¨   Code quality: SonarQube
ïƒ¨   Artifactory or repository tools: nexus, jfrog
ïƒ¨   Application servers: tomcat, jboss, weblogic
ïƒ¨   Web servers: Apache httpd, nginx, Haproxy
ïƒ¨   CI CD tools: Jenkins, bomboo, travis ci
ïƒ¨   Containerization tools: Docker, Rocket
ïƒ¨   Container orchestration tools: K8s, openshift, docker-swarm

ïƒ¨   Configuration management tools: Ansible, puppet, cheff 





NOTE:
By using configuration management tools , We can configure â€œNâ€ number of servers using single machine [configuration server]

Ansible à°’à°• automation tool. à°‡à°¦à°¿ à°’à°•à±‡à°¸à°¾à°°à°¿ multiple servers à°²à±‹ software install, service start, user create à°šà±‡à°¯à°¡à°¾à°¨à°¿à°•à°¿ à°‰à°ªà°¯à±‹à°—à°ªà°¡à±à°¤à±à°‚à°¦à°¿.




Introduction
===========
ïƒ¨   Ansible is an open source, a Configuration Management Tool and Deployment tool, maintained by Redhat.

ïƒ¨   The main components of Ansible are playbooks, configuration management, deployment.

ïƒ¨   Ansible uses playbooks to deploy, manage, build, test and configure anything from full server environments to custom compiled source code for applications.

ïƒ¨   Ansible was written in Python.



Configuration can be any task which we can perform on servers (hosts). It can be

1)  Install/Update/Uninstalling software (packages)
2)  Copy files. Changing the permissions on the files or directories.
3)  Start/Stop/ Restart the services
4)  Creating / deleting the users..........




Various Configuration Management Tools
======================================

â€¢   Ansible
â€¢   Chef
â€¢   Puppet
â€¢   Salt Stack



Ansible Features
================
ïƒ¨   Ansible configure machines in an agent-less manner using SSH.
ïƒ¨   Built on top of Python and hence provides a lot of Pythonâ€™s functionality. YAML-Based Playbooks
ïƒ¨   Uses SSH for secure connections.
ïƒ¨   Follows Push based architecture for sending configurations.


IQ]   Pull Based vs Push Based

Tools like Puppet and Chef are pull based.
Agents on the server periodically checks for the configuration information from central server (Master).

Ansible is push based.
Central server pushes the configuration information on target servers. You control when the changes are made on the servers.





Ansible Architecture
=====================
https://www.google.com/search?sca_esv=8536d3cccb765549&sca_upv=1&rlz=1C1UEAD_enIN1101IN1102&sxsrf=ADLYWIK0P5dFDyf9SS8wj0ACVkOY-eTgQg:
1727466226227&q=ansible+architecture&udm=2&fbs=AEQNm0DYVld7NGDZ8Pi819Yg8r6em07j6rW9d2jUMtr8MB7hthlxj_a5JB7GtKl9Rvi8UOrX6vOKeE8ctU8C4v5SDrHEsrg
UOOFp5HvlkBZf4yVP83YajKnrlhAJvHG8uQnJWlvuYz8LvE_lwESvEPu-1v94fKd9xhS49UTuNSe7CMY7I5AuGmdDN0lv5iId0gIyD9wyA5aKEve0q31Gi2kwmyWtccpVrQ&sa=X&ved=
2ahUKEwiolpqW8eOIAxW8R2wGHdidNlUQtKgLegQILRAB&biw=1440&bih=825&dpr=2#vhid=DpiNvVdi7i47aM&vssid=mosaic



Host Inventory:
===============
In Ansible, the host inventory is a file that defines the hosts (machines) that Ansible will manage. This file can be in various formats, 
but the most common is the INI format. You can also use YAML format for more complex structures.

Some important points in Inventory file.
-   Comments begin with the '#' character
-   Blank lines are ignored
-   Groups of hosts are delimited by [header] elements
-   You can enter hostnames or ip addresses
-   A hostname/ip can be a member of multiple groups
-   Ungrouped hosts are specifying before any group headers, like below


kkdevops.com
192.168.0.9
192.168.9.6

[webservers] 
#192.168.122.1
192.168.122.2
192.168.122.3
kkdevops.com


[dbservers]
192.168.122.4
192.168.122.5
192.168.122.2





--> We have two types of inventories

1. static inventory
-------------------
It is a file in the ansible server. It contains the host machine details, Whenever we want to add/remove server information 
we have to update the static inventory file manually.
                                       -------------



2. dynamic inventory
--------------------
It is an inventory that automatically fetches host information from external sources such as cloud providers, CMDBs, or scripts.
The server details are generated dynamically at runtime, so manual updates are not required.

Dynamic inventory is commonly used in cloud environments where servers are frequently created and terminated.

Examples of sources: AWS (EC2), Azure, GCP

Custom scripts (Python, Shell)


Advantages:
-----------

Automatically updates host information

Reduces manual effort and human errors

Ideal for large-scale and cloud-based infrastructures

NOTE: default inventory path: /etc/ansible/hosts

Ansible playbook à°²à±‹ plays, tasks, modules, variables, handlers, conditionals, loops à°‰à°‚à°Ÿà°¾à°¯à°¿. à°‡à°µà°¿ servers automation à°¨à°¿ easy à°—à°¾ à°šà±‡à°¸à±à°¤à°¾à°¯à°¿.




PlayBooks
==========

-> An Ansible playbook is a YAML file that defines a set of tasks to be executed on one or more  hosts. 


Key Components of a Playbook
----------------------------

1. Plays: Each play in a playbook maps a group of hosts to a set of tasks. A playbook can contain multiple plays.

2. Tasks: These are the actions to be performed on the hosts. Each task typically uses an Ansible module to define what to do
   (e.g., installing a package, copying files, or executing commands).

3. Modules: Ansible comes with many built-in modules that provide functionality for managing different systems and services.

4. Variables: You can define variables within playbooks to manage values dynamically and make your playbooks more flexible.

5. Handlers: Handlers are special tasks that run only when notified by another task. They are often used for restarting services after a configuration change.

6. Conditionals and Loops: Playbooks support conditionals (e.g., when statements) and loops (e.g., with_items) to control the flow of tasks based on 
   specific conditions or to iterate over a list.


Example:
--------

- name: Install Git on all servers
  hosts: all
  tasks:
    - name: Install Git
      yum:
        name: git
        state: present


Example:
--------

- name: Install Unzip on Database Servers
  hosts: dbservers
  tasks:
    - name: Install Unzip
      yum:
        name: unzip
        state: present



1ï¸âƒ£ Plays à°…à°‚à°Ÿà±‡ à°à°®à°¿à°Ÿà°¿?

à° servers (hosts) à°®à±€à°¦

à° à°ªà°¨à±à°²à± (tasks) à°šà±‡à°¯à°¾à°²à±‹ à°šà±†à°ªà±à°ªà±‡ à°­à°¾à°—à°‚

ðŸ“Œ à°’à°• playbook à°²à±‹ à°’à°•à°Ÿà°¿ à°²à±‡à°¦à°¾ à°Žà°•à±à°•à±à°µ plays à°‰à°‚à°¡à±Šà°šà±à°šà±

ðŸ§  Example: à°ˆ servers à°²à±‹ nginx install à°šà±‡à°¯à°¾à°²à°¿  ðŸ‘‰ à°‡à°¦à°¿ à°’à°• play




2ï¸âƒ£ Tasks à°…à°‚à°Ÿà±‡ à°à°®à°¿à°Ÿà°¿?

server à°²à±‹ à°šà±‡à°¯à°¾à°²à±à°¸à°¿à°¨ à°’à°• à°ªà°¨à°¿

Example:  software install à°šà±‡à°¯à°¡à°‚, service start à°šà±‡à°¯à°¡à°‚, file copy à°šà±‡à°¯à°¡à°‚

ðŸ“Œ à°’à°• play à°²à±‹ à°šà°¾à°²à°¾ tasks à°‰à°‚à°¡à±Šà°šà±à°šà±

ðŸ§  Example:  Task 1: nginx install, Task 2: nginx start




3ï¸âƒ£ Modules à°…à°‚à°Ÿà±‡ à°à°®à°¿à°Ÿà°¿?

Ansible à°²à±‹ already à°‰à°¨à±à°¨ tools / functions

ðŸ‘‰ à°ªà±à°°à°¤à°¿ task à°’à°• module à°‰à°ªà°¯à±‹à°—à°¿à°¸à±à°¤à±à°‚à°¦à°¿

Common modules:

yum â†’ software install

service â†’ service start/stop

copy â†’ files copy

user â†’ user create

ðŸ§  Simple à°®à°¾à°Ÿà°²à±à°²à±‹:

Module = à°ªà°¨à°¿ à°šà±‡à°¯à°¡à°¾à°¨à°¿à°•à°¿ à°‰à°ªà°¯à±‹à°—à°¿à°‚à°šà±‡ tool




4ï¸âƒ£ Variables à°…à°‚à°Ÿà±‡ à°à°®à°¿à°Ÿà°¿?

values à°¨à°¿ change à°šà±‡à°¯à°¡à°¾à°¨à°¿à°•à°¿ à°‰à°ªà°¯à±‹à°—à°¿à°¸à±à°¤à°¾à°°à±

à°‰à°¦à°¾à°¹à°°à°£: software name, port number, username

ðŸ§  Example:
package_name: nginx

ðŸ‘‰ à°¤à°°à±à°µà°¾à°¤:

name: "{{ package_name }}"

ðŸ“Œ à°’à°•à°¸à°¾à°°à°¿ change à°šà±‡à°¸à±à°¤à±‡ everywhere update à°…à°µà±à°¤à±à°‚à°¦à°¿ ðŸ‘





5ï¸âƒ£ Handlers à°…à°‚à°Ÿà±‡ à°à°®à°¿à°Ÿà°¿?

à°…à°µà°¸à°°à°‚ à°‰à°¨à±à°¨à°ªà±à°ªà±à°¡à±‡ run à°…à°¯à±à°¯à±‡ tasks

service restart à°šà±‡à°¯à°¡à°¾à°¨à°¿à°•à°¿ à°‰à°ªà°¯à±‹à°—à°¿à°¸à±à°¤à°¾à°°à±

ðŸ§  Real Example: config file change à°…à°¯à°¿à°‚à°¦à°¿

à°…à°ªà±à°ªà±à°¡à± à°®à°¾à°¤à±à°°à°®à±‡ nginx restart à°•à°¾à°µà°¾à°²à°¿

ðŸ‘‰ everyday restart à°…à°µà°¸à°°à°‚ à°²à±‡à°¦à± âŒ




6ï¸âƒ£ Conditionals & Loops à°…à°‚à°Ÿà±‡ à°à°®à°¿à°Ÿà°¿?

ðŸ‘‰ Condition true à°…à°¯à°¿à°¤à±‡à°¨à±‡ task run à°…à°µà±à°¤à±à°‚à°¦à°¿

ðŸ§  Example: OS Ubuntu à°…à°¯à°¿à°¤à±‡à°¨à±‡ install à°šà±‡à°¯à°¾à°²à°¿

when: ansible_os_family == "Debian"

ðŸ”¹ Loops

ðŸ‘‰ à°’à°•à±‡ à°ªà°¨à°¿ à°šà°¾à°²à°¾ items à°®à±€à°¦ repeat à°šà±‡à°¯à°¡à°¾à°¨à°¿à°•à°¿

ðŸ§  Example: nginx, git, docker

ðŸ‘‰ 3 softwares install à°šà±‡à°¯à°¾à°²à°¿

loop:
  - nginx
  - git
  - docker




Easy Telugu Reading Style (Audio-like ðŸ˜„)

Play à°…à°‚à°Ÿà±‡ â€“--------- à° server à°²à±‹ à° à°ªà°¨à°¿ à°šà±‡à°¯à°¾à°²à±‹ à°šà±†à°ªà±à°ªà°¡à°‚

Task à°…à°‚à°Ÿà±‡ â€“----------server à°²à±‹ à°šà±‡à°¸à±‡ à°’à°• à°ªà°¨à°¿

Module à°…à°‚à°Ÿà±‡ â€“------- à°† à°ªà°¨à°¿ à°šà±‡à°¯à°¡à°¾à°¨à°¿à°•à°¿ à°‰à°ªà°¯à±‹à°—à°¿à°‚à°šà±‡ tool

Variable à°…à°‚à°Ÿà±‡ â€“----- change à°…à°¯à±à°¯à±‡ value

Handler à°…à°‚à°Ÿà±‡ â€“------ à°…à°µà°¸à°°à°‚ à°‰à°¨à±à°¨à°ªà±à°ªà±à°¡à±‡ run à°…à°¯à±à°¯à±‡ task

Condition à°…à°‚à°Ÿà±‡ â€“---- condition true à°…à°¯à°¿à°¤à±‡à°¨à±‡ à°ªà°¨à°¿

Loop à°…à°‚à°Ÿà±‡ â€“--------- à°’à°•à±‡ à°ªà°¨à°¿ à°šà°¾à°²à°¾ à°¸à°¾à°°à±à°²à± à°šà±‡à°¯à°¡à°‚






core modules
============

Playbook tasks can be implemented through core modules.

custom modules
==============

we can implement our own modules using the python, But thousands of predefined modules are available.



===============================================================================================================================================


Ansible installation
====================

IQ] what are the prerequsites required to install ansible?

OS: linux
lang: python

NOTE: Using ansible we can configure the windows m/c, But ansible is not installed on windows.


step 1: create 3 redhat systems
-------

[1- Ansible system, 2- Host systems for demo] in AWS

ansible server: 172.31.6.49
Host machine 1: 172.31.3.215
Host machine 2: 172.31.6.156


step 2: waste of india this step 2
----------------------------------

 Login As a root user and create ansible user and provide sudo access in all Servers.

    2.1) Create the user ansible and set the password on all hosts:
           sudo useradd ansible
           sudo passwd ansible
     
    2.2) Make the necessary entry in sudoers file /etc/sudoers for ansible        
           user for password-less sudo access:
          
           visudo

           ansible ALL=(ALL) NOPASSWD: ALL

       

    2.3) Make the necessary changes  in sshd_config file /etc/ssh/sshd_config    
           to enable password based authentication.

         Un comment PasswordAuthentication yes
         and comment  PasswordAuthentication no.
         And save the file .

           sudo vi /etc/ssh/sshd_config

     2.4)    Then restart sshd service.
                sudo service sshd restart

==========



Run in the ansible server
-------------------------

sudo yum install ansible-core -y


sudo su - ansible

sudo vi /etc/ansible/hosts

[my_hosts]
172.31.3.215 ansible_ssh_user=ec2-user ansible_ssh_private_key_file=~/kkdevopsb7.pem

172.31.6.156 ansible_ssh_user=ec2-user ansible_ssh_private_key_file=~/kkdevopsb7.pem


NOTE: pls copy the pem file into linux server

ansible all -m ping

ðŸ”¸ ansible ------- Ansible command-line tool

ðŸ”¸ all ----------- Inventory à°²à±‹ à°‰à°¨à±à°¨ à°…à°¨à±à°¨à°¿ servers 

ðŸ”¸ -m ping ------- ping module à°‰à°ªà°¯à±‹à°—à°¿à°‚à°šà±

à°‡à°¦à°¿ network ping à°•à°¾à°¦à±

à°‡à°¦à°¿ Ansible ping (SSH + Python check)

ðŸ§  à°‡à°¦à°¿ à°à°®à°¿ à°šà±‡à°¸à±à°¤à±à°‚à°¦à°¿?

1. Ansible server à°¨à±à°‚à°šà°¿

2. target servers à°•à°¿ SSH connect à°…à°µà±à°¤à±à°‚à°¦à°¾?

3. Python available à°‰à°‚à°¦à°¾?

4. Credentials à°¸à°°à±ˆà°‚à°¦à°¾?

5. syntax crrt ga unda leda ani check cheysthundi

ðŸ‘‰ à°‡à°µà°¨à±à°¨à±€ OK à°…à°¯à°¿à°¤à±‡ response à°‡à°¸à±à°¤à±à°‚à°¦à°¿.

output
------

server1 | SUCCESS => {
    "changed": false,
    "ping": "pong"
}

ðŸ‘‰ pong à°…à°‚à°Ÿà±‡:
âœ”ï¸ Server reachable
âœ”ï¸ SSH working
âœ”ï¸ Ansible ready

âŒ Failure Example
------------------

server1 | UNREACHABLE!

ðŸ‘‰ Meaning:
â€¢ SSH issue
â€¢ Wrong user / password
â€¢ SSH key problem
â€¢ Firewall blocked
- SSH service not running
- Wrong inventory IP
- Port 22 blocked
- Permission denied



ansible all -m ping -o --> It will display in single line

Example:
--------
server1 | SUCCESS => ping=pong
server2 | SUCCESS => ping=pong

===============================================================================




some sample commands
====================

shell module: To check status
-----------------------------

ansible all -m shell -a "df -kh"       [ -a means arguments]

ansible all -m shell -a "git --version"

             (or)

ansible AWS -b -m command -a "httpd -v"

NOTE: in ansible default module is "shell"

ansible all -m shell -a "uptime" or ansible all -a "uptime"


IQ] instead of checking all the servers how to check for specific servers like DB or app

1. sudo vi /etc/ansible/hosts

2. [app]
   app1 ansible_host=172.31.0.113
   app2 ansible_host=172.31.3.49

   [db]
   db1 ansible_host=172.31.3.101

   [prod:children]
   app
   db

3. ansible app -m shell -a "zip --version"

4. ansible db -b -m yum -a "name=zip state=present"

5. Target multiple groups together ---------> ansible app:db -m ping

6. Exclude a group ------> ansible all:!db -m ping

7. ansible app -a "free -h"

8. ansible db -a "date"

9. ansible db -m ping -----> only db




yum module: To install
----------------------

ansible all -b -m yum -a "name=git"  ----> install git

ansible all -b -m yum -a "name=git,vim,zip state=absent"  --------> uninstall

ansible all -b -m yum -a "name=java" ----> install java

ansible all -a "java --version"  --------> Java version check command



ansible all -b -m yum -a "name=httpd state=present" --> Install httpd package in all node.

ansible all -b -m yum -a "name=httpd state=latest" ---> to update the httpd packages

ansible all -b -m yum -a "name=httpd state=absent" ---> to remove/uninstall httpd package




service module: To start, stop, restart
---------------------------------------

ansible 172.31.43.147 -b -m service -a "name=httpd state=started"

ansible all -b -m command -a "systemctl status httpd"

ansible all -b -m service -a "name=httpd state=restarted"

ansible all -b -m service -a "name=httpd state=stopped"
