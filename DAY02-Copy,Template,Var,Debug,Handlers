requirement:
------------

1. Install httpd software in all the servers.
2. copy the index.html to all the servers.
3. start the httpd service.

Sol:
----

1. ansible all -b -m yum -a "name=httpd state=present"

2. create index.html 

  ansible appserver -b -m copy -a "src=index.html dest=/var/www/html/index.html"

 ansible   ----→ Ansible command
 appserver ----→ inventory లో ఉన్న appserver group
 -b        ----→ become (root permissions)
 -m copy   ----→ copy module ఉపయోగించు
 -a        ----→ module arguments


3. ansible all -b -m service -a "name=httpd state=started"


here disadvantage is we need everytime to run the many commands, so we are going "playbooks"



Ansible playbooks
=================

--> we need write a playbook in the form of YAML
                    --------
--> playbook is a single yaml file, which contains many play
                                                        -----
--> play is set of order tasks to execute in host machines
                         -----
--> Task is an action to perform on host machines.

Example
=======

---
- hosts: all
  gather_facts: no   # in output it will shows more same lines so disable it (no) by default it is true 
  tasks:
  - name: pinging the host machines
    ping:



How to run a playbook?
------------------------

ansible-playbook ping.yaml

ansible-playbook ping.yaml --syntax-check   ----------> to check the syntax error had a crrt ansible playbook 


IQ] can you write a ansible play-book to create file to all host machines.

while practise plz check these commands difference then write what i understand

ansible all -b -m copy -a "src=security.py dest=/tmp/security.py" 

ansible all -b -m command -a "touch security.py"

example 1 playbook filename ping.yaml
-------------------------------------

---
- name: Create a file
  hosts: all
  become: true
  gather_facts: yes

  tasks:
    - name: Create a file anil.yaml
      file:
        path: /home/ec2-user/anil.yaml
        owner: ec2-user
        group: ec2-user
        mode: '0644'
        state: touch


example 2 playbook filename anil.yaml
-------------------------------------
---
- name: Create a file based on OS
  hosts: all
  become: true
  gather_facts: yes

  tasks:
    - name: Create file on Amazon Linux
      file:
        path: /home/ec2-user/anil.yaml
        owner: ec2-user
        group: ec2-user
        mode: '0644'
        state: touch
      when: ansible_os_family == "RedHat"

    - name: Create file on Ubuntu
      file:
        path: /home/ubuntu/anil.yaml
        owner: ubuntu
        group: ubuntu
        mode: '0644'
        state: touch
      when: ansible_os_family == "Debian"

in any different server like amazon,redhat,ubuntu... use above yaml file 

ansible-playbook ping.yaml --syntax-check

ansible-playbook ping.yaml


example 2 playbook filename httpd.yaml
--------------------------------------

before writing a playbook plz create a filename httpd.yaml plz refer example 3 playbook filename demo.yaml at line number 137

---
- hosts: all
  gather_facts: yes
  become: true

  tasks:
    - name: Install httpd
      yum:
        name: httpd
        state: present

    - name: Copy abc.html file
      copy:
        src: abc.html
        dest: /var/www/html/abc.html

    - name: Start httpd service
      service:
        name: httpd
        state: started
        enabled: yes


ansible-playbook httpd.yaml --syntax-check

ansible-playbook httpd.yaml

ansible all -m shell -a "systemctl status httpd" ---------> to check all server IP address machines whether it is install or not

ansible all -m shell -a "ls -lrth /var/www/html" ----------> another way to check install or not



================================================================================================================================================

IQ] what is the difference between copy module and template module?

plz check difference where we are using copy at line number 181
** copy: copy will copy the file from local (ansible server) to remote machines.
** template: template will copy file from local(ansible server) to remote(host) machines, It replace the content using variables, while copying.



we are using in this file static mode
before writing a playbook plz create a filename index.html in that file insert some data like privacy 
save index.html ekkada nenu data antha hardcoded chey ledu

<!DOCTYPE html>
<html>
<head>
  <title>DevOps Practice Page</title>
</head>
<body>

  <h1>Hi, I'm Anil Kumar</h1>

  <p> Phone Number: <strong>6303717004</strong> </p>

  <p> I am learning <strong>DevOps course</strong> from <strong>Location: Adoni, Kurnool (Dist), Andhra Pradesh</strong>.</p>

  <p> <strong>Privacy:</strong> Hardcore Dynamic </p>

</body>
</html>

example 3 playbook filename demo1.yaml
--------------------------------------
---
- name: Install and configure Apache HTTP server
  hosts: all  
  become: true 

  tasks:
    - name: Install httpd
      yum:  # Use yum for Red Hat/CentOS or dnf for newer versions
        name: httpd
        state: present

    - name: Ensure httpd is started and enabled
      service:
        name: httpd
        state: started
        enabled: true

    - name: Copy custom index.html to the web root
      copy:
        src: index.html     # Path to your local index.html file
        dest: /var/www/html/index.html  # Destination on the target server


ansible-playbook demo1.yaml --syntax-check

ansible-playbook demo1.yaml


ansible all -m shell -a "systemctl status httpd" ---------> to check all server IP address machines whether it is install or not

ansible all -m shell -a ls -lrth /var/www/html  ----------> another way to check install or not

-------------------------------------------------------------------------------------------------------------------------------------------------

<!DOCTYPE html>
<html>
<head>
  <title>{{ page_title }}</title>
</head>
<body>

  <h1>Hi, I'm {{ name }} </h1>

  <p> Phone Number: <strong>{{ phone }}</strong> </p>

  <p> I am learning <strong>{{ course }}</strong> from <strong>Location: {{ location }}</strong>.</p>

</body>
</html>



example 3 playbook filename demo2.yaml here i hardcoded the data for copy
-------------------------------------------------------------------------
---
- name: Install and configure Apache HTTP server
  hosts: all
  become: true

  vars:
    page_title: "DevOps Practice Page"
    name: "AnilKumar"
    phone: "9347888769"
    course: "DevOps course"
    location: "Adoni, Kurnool (Dist), Andhra Pradesh"

  tasks:
    - name: Install httpd
      yum:
        name: httpd
        state: present

    - name: Ensure httpd is started and enabled
      service:
        name: httpd
        state: started
        enabled: true

    - name: Copy dynamic index.html to web root
      copy:
        src: index.html
        dest: /var/www/html/index.html





Template module
----------------

before writing a playbook plz create a filename index.html in that file insert some data like privacy to hardcoded dynamic name and location and some other


example 4 Template template.yaml at line number 321 its will changes lines
--------------------------------------------------------------------------
create two yaml files for check difference between using template and template vars save index.html

<!DOCTYPE html>
<html>
<head>
  <title>DevOps Automation Page</title>
</head>

<body>

  <h1>Hi, I'm Anil Kumar</h1>

  <p> <strong>Phone Number:</strong>{{ phone }} </p>

  <p> I am learning <strong>DevOps Course</strong> </p>

  <p> <strong>Location:</strong> {{ location }} </p>

  <p> <strong>Date:</strong> {{ ansible_date_time.date }} </p>

  <p> <strong>Time:</strong> {{ ansible_date_time.time }} </p>

  <hr>

  <p>
    <em>
      This page is automatically deployed using
      <strong>Ansible Automation</strong>.
    </em>
  </p>

</body>
</html>



save this ansible playbook with template1.yaml
-----------------------------------------------

---
- name: Install and configure Apache HTTP server
  hosts: all  # Specify your target hosts group
  become: true  # Use sudo to install packages
  vars:
    location: "Adoni, kurnool (dist), Andhra Pradesh"       # Change this to your server name
    Phone: "6303717004"
    date: "enter today date"  # Change this to your desired document root
    time: "enter time" # date & time vars అవసరం లేదు ansible_date_time facts template లో directly use చేస్తాం

  tasks:
    - name: Install httpd
      yum:  # Use yum for Red Hat/CentOS or dnf for newer versions
        name: httpd
        state: present

    - name: Ensure httpd is started and enabled
      service:
        name: httpd
        state: started
        enabled: true

    - name: Copy custom index.html to the web root
      template:
        src: index.html  # Path to your local index.html file
        dest: /var/www/html/index.html  # Destination on the target server



---------------------------------------------------------------------------------------------------------------------------------------------------------




before writing a playbook plz create a filename index.html in that file insert some data like privacy to hardcore dyanmic name and location and some other
<!DOCTYPE html>
<html>
<head>
  <title>{{ page_title }}</title>
</head>
<body>

  <h1>Hi, I'm {{ name }}</h1>

  <p><strong>Phone:</strong> {{ phone }}</p>
  <p><strong>Course:</strong> {{ course }}</p>
  <p><strong>Location:</strong> {{ location }}</p>
  <p><strong>Date:</strong> {{ ansible_date_time.date }}</p>
  <p><strong>Operating System:</strong>{{ ansible_distribution }} {{ ansible_distribution_version }}</p>

  <hr>

  <p>
    <em>Deployed using {{ automation_tool }}</em>
  </p>

</body>
</html>


============================================================================================================================================
                                                        chtgpt best practices
============================================================================================================================================

save this ansible playbook with template2.yaml
-----------------------------------------------
---
- name: Install and configure Apache HTTP Server
  hosts: all      # Specify your target hosts group
  become: true    # Use sudo to install packages

  vars:
    page_title: "DevOps Automation Page"
    name: "Anil Kumar"                                        # Change this to your server name
    phone: "6303717004"                                       # Change this to your desired document root
    course: "DevOps Course"
    location: "Adoni, Kurnool (Dist), Andhra Pradesh, India"  
    OS: "Amazon Linux 2023"
    automation_tool: "Ansible Automation"

  tasks:
    - name: Install Apache (httpd)
      yum:                               # Use yum for Red Hat/CentOS or dnf for newer versions
        name: httpd
        state: present

    - name: Start and enable Apache service
      service:
        name: httpd
        state: started
        enabled: true

    - name: Copy dynamic index.html to web root
      template:
        src: /home/ec2-user/index.html                   # Path to your local index.html file
        dest: /var/www/html/index.html    # Destination on the target server




============================================================================================================================================
                                                        KKfunda
============================================================================================================================================

---
- name: Install and configure Apache HTTP server
  hosts: all  # Specify your target hosts group
  become: true  # Use sudo to install packages
  vars:
    location: "Adoni, kurnool (dist), Andhra Pradesh"       # Change this to your server name
    date: "enter today date"  # Change this to your desired document root
    time: "enter time" # date & time vars అవసరం లేదు ansible_date_time facts template లో directly use చేస్తాం
     # next yaml file plz add Phone: "6303717004"
  tasks:
    - name: Install httpd
      yum:  # Use yum for Red Hat/CentOS or dnf for newer versions
        name: httpd
        state: present

    - name: Ensure httpd is started and enabled
      service:
        name: httpd
        state: started
        enabled: true

    - name: Copy custom index.html to the web root
      template:
        src: index.html  # Path to your local index.html file
        dest: /var/www/html/index.html  # Destination on the target server


=============================================================================================================================================================


Playbook run చేసే time లో
variables కి values ఇవ్వడం లేదా
playbook లో ఉన్న values ని override చేయడం

location variable కి value = hyd
playbook లో location ఉన్నా కూడా
run time value use అవుతుంది

Using -e option, we can pass variables at run time and override playbook variables.


1. ansible-playbook template1.yaml -e location="hyd"
 
2. ansible-playbook template1.yaml -e 'location=hyd phoneNo=99999999'

3. ansible-playbook template1.yaml -e '{"location":"hyd","phoneNo":"99999999"}'


example: 1 for all
-------------------
ansible-playbook template1.yaml -e page_title="DevOps Practice Page"
ansible-playbook template1.yaml -e course="DevOps Course"
ansible-playbook template1.yaml -e name="Anil Kumar"
ansible-playbook template1.yaml -e phoneNo="6303717004"
ansible-playbook template1.yaml -e location="Adoni"
ansible-playbook template1.yaml -e automation_tool="Ansible Automation"

this is high priority by runtime

example 3 for all in json format
-------------------------------
• Variable names must exactly match template/playbook
• JSON quotes correct గా ఉండాలి
• Space ఉన్న values JSON లో safe


ansible-playbook template1.yaml -e '{"location":"hyd","phoneNo":"6303717004","name":"Anil Kumar","course":"DevOps Course",
"page_title":"DevOps Practice Page","automation_tool":"Ansible Automation"}'





variables in ansible
=====================
IQ] can you explain varibles and its priority in ansible?

1. command line variables
2. variables in file
3. variables in play-book


another approach
----------------

step 1: create separate vars.yaml

    page_title: "DevOps Automation Page"
    name: "Anil Kumar"                                        # Change this to your server name
    phone: "6303717004"                                       # Change this to your desired document root
    course: "DevOps Course"
    location: "Adoni, Kurnool (Dist), Andhra Pradesh, India"  #
    OS: "Amazon Linux 2023"
    automation_tool: "Ansible Automation"

step 2: create index.html

<!DOCTYPE html>
<html>
<head>
  <title>{{ page_title }}</title>
</head>
<body>

  <h1>Hi, I'm {{ name }}</h1>

  <p> <strong>Phone:</strong> {{ phone }} </p>
  <p> <strong>Course:</strong> {{ course }} </p>
  <p> <strong>Location:</strong> {{ location }} </p>
  <p> <strong>Date:</strong> {{ ansible_date_time.date }} </p>
  <p> <strong>Operating System:</strong>{{ ansible_distribution }} {{ ansible_distribution_version }} </p>

  <hr>

  <p>
    <em>Deployed using {{ automation_tool }}</em>
  </p>

</body>
</html>


step 3: create a playbook name.yaml

- name: Install and configure Apache HTTP server
  hosts: all  # Specify your target hosts group
  become: true  # Use sudo to install packages
  vars_files:
   - vars.yaml #name.yaml
  tasks:
    - name: Install httpd
      yum:  # Use yum for Red Hat/CentOS or dnf for newer versions
        name: httpd
        state: present

    - name: Ensure httpd is started and enabled
      service:
        name: httpd
        state: started
        enabled: true

    - name: Copy custom index.html to the web root
      template:
        src: index.html  # Path to your local index.html file
        dest: /var/www/html/index.html  # Destination on the target server



***IQ] if i defined variables in plabook and vars.yaml which one will take?

  vars:
    page_title: "DevOps Automation Page"
    name: "Anil Kumar"                                        # Change this to your server name
    phone: "6303717004"                                       # Change this to your desired document root
    course: "DevOps Course"
    location: "Adoni, Kurnool (Dist), Andhra Pradesh, India"  #
    OS: "Amazon Linux 2023"
    automation_tool: "Ansible Automation"
  vars_files:
   - vars.yaml

*** ANS: play-book variables are less priority.

1️⃣ Runtime variables (-e)        ← Highest
   ex - ansible-playbook playbook.yml -e location="bangalore"

2️⃣ vars_files (vars.yaml)        ← Second
   ex - vars.yaml file:
        location: "hyd"
        and playbook.yml:
        vars_files:
          - vars.yaml

3️⃣ Playbook variables (vars)     ← Third
   ex - playbook.yml:
        vars:
          location: "adoni"


===================================================================================================================================



debug module in ansible
========================

The debug module in Ansible is a useful tool for outputting information during playbook execution. It helps you inspect variables, 
confirm task execution, and troubleshoot issues in your Ansible scripts.


Example -1 for debug module
---------------------------

---
- name: Debug Example Playbook
  hosts: all #localhost also its works
  vars:
    app_name: "order-management"
    replica_count: 3
    resource_limits:
      cpu: "500m"
      memory: "512Mi"
    debug_enabled: true
    env: staging

  tasks:
    - name: Print application name
      debug:
        msg: "The application name is {{ app_name }}"

    - name: Print replica count
      debug:
        msg: "The replica count is {{ replica_count }}"

    - name: Print resource limits
      debug:
        msg: "CPU limit is {{ resource_limits.cpu }} and Memory limit is {{ resource_limits.memory }}"


Example - 2 for debug module & template module
----------------------------------------------

---
- name: Install and configure Apache HTTP server
  hosts: all
  become: true

  # Second priority variables
  vars_files:
    - vars.yaml

  # Third priority variables
  vars:
    location: "Tirupathi"
    phoneNo: "000000000"

  tasks:
    - name: showing installation start msg
      debug:
        msg: "installing httpd"

    - name: Installing httpd
      yum:   # Use yum for Red Hat/CentOS or dnf for newer versions
        name: httpd
        state: present

    - name: showing httpd installation completed msg
      debug:
        msg: "installation completed httpd"

    - name: Ensure httpd is started and enabled
      service:
        name: httpd
        state: started
        enabled: true

    - name: Copy custom index.html to the web root
      template:
        src: index.html     # Path to your local index.html template file
        dest: /var/www/html/index.html  # Destination on the target server

vars.yaml 
---------
vars:
    page_title: "DevOps Automation Page"
    name: "Anil Kumar"                                        # Change this to your server name
    phone: "6303717004"                                       # Change this to your desired document root
    course: "DevOps Course"
    location: "Adoni, Kurnool (Dist), Andhra Pradesh, India"  #
    OS: "Amazon Linux 2023"
    automation_tool: "Ansible Automation"


====================================================================================================================================================


Handlers in ansible
====================

IQ] what is the difference between tasks and handlers?

--> Tasks are executed in the order they are defined in the playbook. All tasks will run every time the playbook is executed, 
    unless certain conditions (like when statements) are specified.

--> Handlers are only executed when notified by a task. If a task makes a change (e.g., installing a package or modifying a file) and 
    issues a notification to a handler, the handler will run after all tasks have been processed.

--> handlers are special kind of tasks, It will not executed by default, until other tasks are notify.

--> Handlers will execute at end of the play.

--> Handlers yenti ante just ee okka point chudu copy file lo emina update jaringindi ante appudu maki notify cheyali kadha so anduke 
    handlers ane module use avthundu


Example 1 without changes in index.html
----------------------------------------

- name: Install and configure Apache HTTP server
  hosts: all  # Specify your target hosts group
  become: true  # Use sudo to install packages
  vars_files:
   - vars.yaml
  tasks:
    - name: Install httpd
      yum:  # Use yum for Red Hat/CentOS or dnf for newer versions
        name: httpd
        state: present

    - name: Ensure httpd is started and enabled
      service:
        name: httpd
        state: started
        enabled: true

    - name: Copy custom index.html to the web root
      template:
        src: index.html  # Path to your local index.html file
        dest: /var/www/html/index.html  # Destination on the target server



example 2 after changes then use restart with handlers
-------------------------------------------------------
just changes in index.html

- name: Install and configure Apache HTTP server
  hosts: all  
  gather_facts: no
  become: true  
  vars_files:
   - vars.yaml
  tasks:
    - name: Install httpd
      yum:  
        name: httpd
        state: present

    - name: Ensure httpd is started and enabled
      service:
        name: httpd
        state: started
        enabled: true

    - name: Copy custom index.html to the web root
      template:
        src: index.html  # Path to your local index.html file
        dest: /var/www/html/index.html  # Destination on the target server
      notify:
        - restarting httpd
  handlers:
    - name: restarting httpd
      service:
        name: httpd
        state: restarted
